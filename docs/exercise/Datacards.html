<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Making Datacards &#8212; Mono Z v1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/groundwork.css?v=72c1018e" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=a5c4661c" />
    <script src="../_static/documentation_options.js?v=5cb08e4e"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../_static/monoz.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running Combine" href="Combine.html" />
    <link rel="prev" title="Making Histograms" href="Histograms.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Combine.html" title="Running Combine"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Histograms.html" title="Making Histograms"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Mono Z v1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Making Datacards</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="making-datacards">
<h1>Making Datacards<a class="headerlink" href="#making-datacards" title="Link to this heading">¶</a></h1>
<a class="reference internal image-reference" href="../_images/datacard.png"><img alt="Alternative text" src="../_images/datacard.png" style="width: 900px;" />
</a>
<p>An important part of an analysis before running combine is the creation of datacards describing the rates, uncertainties and normalizations for the various processes used in the analysis. In this section we will describe what a typical datacard looks like and the various components. Finally we can run our own datacards and see the limits as described in the following section.</p>
<section id="mono-z-datacards">
<h2>Mono Z Datacards<a class="headerlink" href="#mono-z-datacards" title="Link to this heading">¶</a></h2>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>imax * number of categories
jmax * number of samples minus one
kmax * number of nuisance parameters
------------------------------
shapes * * shapes-chBSM2016.root $PROCESS $PROCESS_$SYSTEMATIC
bin           chBSM2016
observation      2236.0
------------------------------
------------------------------
bin                                 chBSM2016      chBSM2016      chBSM2016      chBSM2016      chBSM2016      chBSM2016      chBSM2016
process                             Signal         ZZ             WZ             WW             VVV            TOP            DY
process                             0              1              2              3              4              5              6
rate                                151.785        470.638        352.725        74.218         2.589          280.862        811.159
------------------------------
CMS_BTag_2016            shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_EFF_e                shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_EFF_m                shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_JER_2016             shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_JES_2016             shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_PU_2016              shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_QCDScaleSignal_2016  shape      1.000            -              -              -              -              -              -
CMS_QCDScaleTOP_2016     shape        -              -              -              -              -            1.000            -
CMS_QCDScaleVVV_2016     shape        -              -              -              -            1.000            -              -
CMS_QCDScaleWW_2016      shape        -              -              -            1.000            -              -              -
CMS_QCDScaleWZ_2016      shape        -              -            1.000            -              -              -              -
CMS_QCDScaleZZ_2016      shape        -            1.000            -              -              -              -              -
CMS_RES_e                  lnN      1.005          1.005          1.005          1.005          1.005          1.005          1.005
CMS_RES_m                  lnN      1.005          1.005          1.005          1.005          1.005          1.005          1.005
CMS_Trig_2016            shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_Vx_2016              shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_lumi_2016              lnN      1.025          1.025          1.025          1.025          1.025          1.025          1.025
CMS_pfire_2016           shape      1.000            -              -              -              -              -              -
EWKWZ                    shape        -              -            1.000            -              -              -              -
EWKZZ                    shape        -            1.000            -              -              -              -              -
PDF_2016                 shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
UEPS                       lnN      1.020          1.020          1.020          1.020          1.020          1.020          1.020
VVnorm_0_                shape        -            1.000          1.000              -            -              -              -
VVnorm_1_                shape        -            1.000          1.000              -            -              -              -
VVnorm_2_                shape        -            1.000          1.000              -            -              -              -
EMnorm_2016 rateParam chBSM* WW 1 [0.1,10]
DYnorm_2016 rateParam chBSM* DY 1 [0.1,10]
chBSM2016 autoMCStats 0 0 1
EMnorm_2016 rateParam chBSM* TOP 1 [0.1,10]
</pre></div>
</div>
</section>
<section id="understanding-the-datacards">
<h2>Understanding the datacards<a class="headerlink" href="#understanding-the-datacards" title="Link to this heading">¶</a></h2>
<p>A counting experiment is a search where we just count the number of events that pass a selection, and compare that number with the event yields expected from the signal and background.</p>
<p>A shape analysis relies not only on the expected event yields for the signals and backgrounds, but also on the distribution of those events in some discriminating variable. This approach is often convenient with respect to a counting experiment, especially when the background cannot be predicted reliably a-priori, since the information from the shape allows a better discrimination between a signal-like and a background-like excess, and provides an in-situ normalization of the background.</p>
<p>The simpler case of shape analysis is the binned one: the observed distribution of the events in data and the expectations from the signal and all backgrounds are provided as histograms, all with the same binning. Mathematically, this is equivalent to just making N counting experiments, one for each bin of the histogram; however, in practice it’s much more convenient to provide the the predictions as histograms directly.</p>
<p>For this kind of analysis, all the information needed for the statistical interpretation of the results is encoded in a simple text file. An example was shown above as the datacard for cards-DMSimp_MonoZLL_Pseudo_500_mxd-1/shapes-chBSM2016.dat. Let’s go through the various components of this datacard and try to understand it.</p>
<section id="channels">
<h3>Channels:<a class="headerlink" href="#channels" title="Link to this heading">¶</a></h3>
<p>These lines describe the basics of the datacard: the number of channels, physical processes, and systematical uncertainties Only the first two words (e.g. imax) are interpreted, the rest is a comment.</p>
<ol class="arabic simple">
<li><p><strong>imax</strong> defines the number of final states analyzed (one in this case, but datacards can also contain multiple channels)</p></li>
<li><p><strong>jmax</strong> defines the number of independent physical processes whose yields are provided to the code, minus one (i.e. if you have 2 signal processes and 5 background processes, you should put 6)</p></li>
<li><p><strong>kmax</strong> defines the number of independent systematical uncertainties (these can also be set to * or -1 which instruct the code to figure out the number from what’s in the datacard)</p></li>
</ol>
<p>You’ll notice that in this datacard these numbers are not filled. This is because this datacard is written specifically for the signal region. The full datacard is written in combined.dat and will show these numbers (too long to show here).</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>imax * number of categories
jmax * number of samples minus one
kmax * number of nuisance parameters
</pre></div>
</div>
</section>
<section id="processes-and-rates">
<h3>Processes and Rates<a class="headerlink" href="#processes-and-rates" title="Link to this heading">¶</a></h3>
<p>These lines describe the number of observed events in each final state. In this case, there’s a final state, with label chBSM2016 that contains the events in our signal region. The observation is the number of data events in this channel. You will also se the background then split into the different processes. Does the observation seem to match the background estimation? Check the rates to see if they make sense.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>shapes * * shapes-chBSM2016.root $PROCESS $PROCESS_$SYSTEMATIC
bin           chBSM2016
observation      2236.0
------------------------------
------------------------------
bin                                 chBSM2016      chBSM2016      chBSM2016      chBSM2016      chBSM2016      chBSM2016      chBSM2016
process                             Signal         ZZ             WZ             WW             VVV            TOP            DY
process                             0              1              2              3              4              5              6
rate                                151.785        470.638        352.725        74.218         2.589          280.862        811.159
</pre></div>
</div>
</section>
<section id="systematic-uncertainties">
<h3>Systematic Uncertainties<a class="headerlink" href="#systematic-uncertainties" title="Link to this heading">¶</a></h3>
<p>The next section deals with the uncertainties and normalizations associated with the different yields. The way systematical uncertainties are implemented in the Higgs statistics package is by identifying each <em>independent source</em> of uncertainty, and describing the effect it has on the event yields of the different processes. Each source is identified by a name, and in the statistical model it will be associated with a nuisance parameter.</p>
<p>An individual source of uncertainty can have an effect on multiple processes, also across different channels, and all these effects will be correlated (e.g., the uncertainty on the production cross section for DY will affect the expected event yield for this process in all datacards). While not necessarily problematic for this analysis, the size of the effect doesn’t have to be the same, e.g., a 1% uncertainty on the muon resolution might have a 2% effect on WW–&gt;
<span class="math notranslate nohighlight">\({2\mu 2\nu}\)</span> but a 4% effect on ZZ–&gt;4l. Anti-correlations are also possible (e.g., an increase in b-tagging efficiency will simultaneously and coherently increase the signal yield in final states that require tagged b-jets and decrease the signal yield in final states that require no tagged b-jets).</p>
<p>The use of names for each source of uncertainty allows the code to be able to combine multiple datacards recognizing which uncertainties are in common and which are instead separate.</p>
<p>The most common model used for systematical uncertainties is the <a class="reference external" href="http://en.wikipedia.org/wiki/Log-normal_distribution">log-normal distribution</a>, which is identified by the <em>lnN</em> keyword in combine. The distribution is characterized by a parameter
<span class="math notranslate nohighlight">\({\kappa}\)</span> , and affects the expected event yields in a multiplicative way: a positive deviation of +1
<span class="math notranslate nohighlight">\({\sigma}\)</span> corresponds to a yield scaled by a factor
<span class="math notranslate nohighlight">\({\kappa}\)</span> compared to the nominal one, while a negative deviation of -1
<span class="math notranslate nohighlight">\({\alpha}\)</span> corresponds to a scaling by a factor 1/
<span class="math notranslate nohighlight">\({\kappa}\)</span> . For small uncertainties, the log-normal is approximately a Gaussian. If
<span class="math notranslate nohighlight">\({\delta}\)</span> x/x* is the relative uncertainty on the yield,
<span class="math notranslate nohighlight">\({\kappa}\)</span> can be set to 1+
<span class="math notranslate nohighlight">\({\delta}\)</span> x/x.</p>
<p>We can also consider systematical uncertainties that affect not just the normalization but also the shape of the expected distribution for a process. You should recognize some of the shape based systematics from the histograms earlier. The datacard helps tell combine what systematics are associated with various processes and how they are correlated. For example, the JES are applied to all processes and the uncertainty is correlated among the different processes, while the EWK corrections are only applied to the WZ and the ZZ and are uncorrelated. Additionally, if you are using the full Run-2 dataset you could set correlations among the different years here as well.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>CMS_BTag_2016            shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_EFF_e                shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_EFF_m                shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_JER_2016             shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_JES_2016             shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_PU_2016              shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_QCDScaleSignal_2016  shape      1.000            -              -              -              -              -              -
CMS_QCDScaleTOP_2016     shape        -              -              -              -              -            1.000            -
CMS_QCDScaleVVV_2016     shape        -              -              -              -            1.000            -              -
CMS_QCDScaleWW_2016      shape        -              -              -            1.000            -              -              -
CMS_QCDScaleWZ_2016      shape        -              -            1.000            -              -              -              -
CMS_QCDScaleZZ_2016      shape        -            1.000            -              -              -              -              -
CMS_RES_e                  lnN      1.005          1.005          1.005          1.005          1.005          1.005          1.005
CMS_RES_m                  lnN      1.005          1.005          1.005          1.005          1.005          1.005          1.005
CMS_Trig_2016            shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_Vx_2016              shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
CMS_lumi_2016              lnN      1.025          1.025          1.025          1.025          1.025          1.025          1.025
CMS_pfire_2016           shape      1.000            -              -              -              -              -              -
EWKWZ                    shape        -              -            1.000            -              -              -              -
EWKZZ                    shape        -            1.000            -              -              -              -              -
PDF_2016                 shape      1.000          1.000          1.000          1.000          1.000          1.000          1.000
UEPS                       lnN      1.020          1.020          1.020          1.020          1.020          1.020          1.020
VVnorm_0_                shape        -            1.000          1.000              -            -              -              -
VVnorm_1_                shape        -            1.000          1.000              -            -              -              -
VVnorm_2_                shape        -            1.000          1.000              -            -              -              -
</pre></div>
</div>
</section>
<section id="normalizations">
<h3>Normalizations<a class="headerlink" href="#normalizations" title="Link to this heading">¶</a></h3>
<p>The last section handles the single bin normalization factors for the EMU (Top and WW) and the DY region. For this the normalization is allowed to float anywhere between 0.1 and 10.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>EMnorm_2016 rateParam chBSM* WW 1 [0.1,10]
DYnorm_2016 rateParam chBSM* DY 1 [0.1,10]
chBSM2016 autoMCStats 0 0 1
EMnorm_2016 rateParam chBSM* TOP 1 [0.1,10]
</pre></div>
</div>
<p>Take some time to look through the datacards for the other channels (control regions). Do they make sense to you? Can you follow some of the systematics and see why they are applied to certain processes and not to others. What about the correlations? The next step would be to look at the combined.dat which combines all of the signal and control regions. These are much bigger but contain the same information. Does the combined datacard make sense? We will be using this as input to combine so make sure these are clear to you.</p>
</section>
<section id="running-your-own-datacards">
<h3>Running your own datacards<a class="headerlink" href="#running-your-own-datacards" title="Link to this heading">¶</a></h3>
<p>The code to run the datacards can be see here <a class="reference external" href="https://github.com/yhaddad/CMSDAS-MonoZ-Tutorial-2024/blob/main/datacards/makecard-boost.py">Datacard</a>.</p>
<p>In here the systematic variations are described here <a class="reference external" href="https://github.com/yhaddad/CMSDAS-MonoZ-Tutorial-2024/blob/main/datacards/makecard-boost.py#L187-L214">systematic_variations</a>.
and the rate params here <a class="reference external" href="https://github.com/yhaddad/CMSDAS-MonoZ-Tutorial-2024/blob/main/datacards/makecard-boost.py#L217-L231">rate_params</a>.</p>
<p>This will run datacards for every file here <a class="reference external" href="https://github.com/yhaddad/CMSDAS-MonoZ-Tutorial-2024/blob/main/datacards/config/input_DAS_2016.yaml">Input</a>.</p>
<p>In order to run this code you will need to tell it the region of interest. This can be seen in an example command below:
Here we can just run the datacard for the SR and examine the datacard to see if it makes sense. You can examine other Dark Matter models by modifying the input_DAS_2016.yaml.
The makecard-boost.py has the systmatics commented out. Feel free to play with these and add them back in.</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>python3 makecard-boost.py --name monoZ --input ./config/input_DAS_2016.yaml --era 2016 --variable met_pt --channel catSignal-0jet
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/monoz.png" alt="Logo of Mono Z"/>
            </a></p>
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Making Datacards</a><ul>
<li><a class="reference internal" href="#mono-z-datacards">Mono Z Datacards</a></li>
<li><a class="reference internal" href="#understanding-the-datacards">Understanding the datacards</a><ul>
<li><a class="reference internal" href="#channels">Channels:</a></li>
<li><a class="reference internal" href="#processes-and-rates">Processes and Rates</a></li>
<li><a class="reference internal" href="#systematic-uncertainties">Systematic Uncertainties</a></li>
<li><a class="reference internal" href="#normalizations">Normalizations</a></li>
<li><a class="reference internal" href="#running-your-own-datacards">Running your own datacards</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="Histograms.html"
                          title="previous chapter">Making Histograms</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="Combine.html"
                          title="next chapter">Running Combine</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/exercise/Datacards.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Combine.html" title="Running Combine"
             >next</a> |</li>
        <li class="right" >
          <a href="Histograms.html" title="Making Histograms"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Mono Z v1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Making Datacards</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, The Mono Z CMSDAS Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>